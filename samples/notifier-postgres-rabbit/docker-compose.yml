version: '3.8'

services:

  # notifier-api:
  #   image:  sflpro/notifier:snapshot
  #   ports:
  #     - "8099:8099"
  #   depends_on:
  #     - notifier-worker
  #   links:
  #     - db
  #     - rabbit
  #   entrypoint: "java -Xms350m -Xmx600m -jar /api-web.jar --spring.config.additional-location=/etc/notifier/notifier.properties"
  #   volumes: 
  #     - type: bind
  #       source: C:\Users\hrant.arakelyan\Desktop\notifier\samples\notifier-postgres-rabbit\notifier.properties
  #       target: /etc/notifier/notifier.properties

  # notifier-worker:
  #   image:  sflpro/notifier-worker:snapshot
  #   depends_on:
  #     - db
  #     - rabbit
  #   links:
  #     - db
  #     - rabbit
  #   restart: on-failure
  #   entrypoint: "java -Xms350m -Xmx600m -jar /worker.jar --spring.config.additional-location=/etc/notifier/notifier.properties"
  #   volumes:
  #     - type: bind
  #       source: C:\Users\hrant.arakelyan\Desktop\notifier\samples\notifier-postgres-rabbit\notifier.properties
  #       target: /etc/notifier/notifier.properties

  db:
    image: postgres:11.5
    restart: always
    environment:
      POSTGRES_USER: notifier
      POSTGRES_PASSWORD: notifier
    ports:
      - "5433:5432"
    volumes:
      - ./../db_init:/docker-entrypoint-initdb.d
      
  rabbit:
    image: rabbitmq:3.7-management
    hostname: rabbit
    healthcheck:
      test: [ "CMD", "nc", "-z", "localhost", "5672" ]
      interval: 5s
      timeout: 15s
      retries: 1
    environment:
        RABBITMQ_ERLANG_COOKIE: SWQOKODSQALRPCLNMEQG
        RABBITMQ_DEFAULT_USER: notifier
        RABBITMQ_DEFAULT_PASS: notifier
        RABBITMQ_DEFAULT_VHOST: /
    ports:
      - "15673:15672"
      - "5673:5672"